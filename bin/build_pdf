#!/usr/bin/env bash

JEKYLL_PORT=${JEKYLL_PORT:-4000}
PDF_PATH=${PDF_PATH:-static/pdf/}

mkdir -p $PDF_PATH

if ! [ -x "$(command -v wkhtmltopdf)" ]; then
    echo 'wkhtmltopdf not installed'
    if [ "$(uname)" == "Darwin" ]; then
        echo 'Install it with "brew cask install wkhtmltopdf"'
    fi
fi

function create_pdf {
    wkhtmltopdf --print-media-type http://localhost:$JEKYLL_PORT $PDF_PATH/cv.pdf
}

if [ -z "$(lsof -i :$JEKYLL_PORT)" ];then
    jekyll serve --incremental --port $JEKYLL_PORT &
    sleep 1
    let JEKYLL_PID=echo $!
    create_pdf
    kill $JEKYLL_PID
else
    create_pdf
fi
exit
